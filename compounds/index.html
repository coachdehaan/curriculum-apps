<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Chem-Name Builder v2</title>
  <style>
    * { box-sizing: border-box; font-family: Arial, sans-serif; }
    body {
      margin: 0;
      padding: 8px;
      display: flex;
      gap: 8px;
      height: 100vh;
    }
    #left, #right {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    h2 {
      margin: 2px 0;
      font-size: 15px;
      font-weight: bold;
    }
    .panel {
      border: 1px solid #444;
      padding: 6px;
      border-radius: 3px;
    }
    #periodic-table {
      display: grid;
      grid-template-columns: repeat(18, 1fr);
      grid-auto-rows: 30px;
      gap: 2px;
      font-size: 10px;
    }
    .element {
      border: 1px solid #999;
      border-radius: 2px;
      text-align: center;
      line-height: 1.1;
      padding-top: 2px;
      cursor: pointer;
      user-select: none;
    }
    .element.metal { background-color: #f4f4ff; }
    .element.nonmetal { background-color: #e9ffe9; }
    .element.metalloid { background-color: #fff7df; }
    .element.inactive {
      border-style: dotted;
      color: #bbb;
      cursor: default;
      background-color: #f9f9f9;
    }
    .element.selected {
      outline: 2px solid #000;
    }

    /* Builder */
    #builder {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .slots-row {
      display: flex;
      gap: 6px;
    }
    .slot {
      flex: 1;
      border: 1px solid #999;
      padding: 4px;
      border-radius: 3px;
      font-size: 11px;
    }
    .slot-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 3px;
    }
    .slot-body {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .slot-symbol {
      font-size: 18px;
      font-weight: bold;
    }
    .slot-meta {
      font-size: 11px;
    }
    .controls {
      display: flex;
      align-items: center;
      gap: 3px;
      font-size: 11px;
    }
    .controls input[type="number"] {
      width: 32px;
    }

    /* Results */
    #results-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11px;
    }
    #results-table td {
      border: 1px solid #ccc;
      padding: 3px 4px;
      vertical-align: top;
    }
    #formula-display {
      font-size: 17px;
      font-weight: bold;
    }
    #name-display {
      font-size: 15px;
      font-weight: bold;
    }
    #bond-summary {
      font-size: 11px;
      white-space: pre-line;
    }
    #pair-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 10px;
      margin-top: 2px;
    }
    #pair-table th, #pair-table td {
      border: 1px solid #ccc;
      padding: 2px 3px;
      text-align: left;
    }
    #explanation {
      font-size: 11px;
      white-space: pre-line;
    }
    .badge {
      display: inline-block;
      padding: 1px 4px;
      border-radius: 3px;
      border: 1px solid #333;
      font-size: 10px;
      margin-right: 4px;
    }
  </style>
</head>
<body>
  <div id="left">
    <div class="panel">
      <h2>Interactive Periodic Table</h2>
      <div id="periodic-table"></div>
    </div>
    <div class="panel" style="font-size: 11px;">
      <strong>How to use in class:</strong>
      <ol style="margin: 4px 0 0 16px; padding-left: 8px;">
        <li>Choose active slot (1, 2, or 3) and click an element.</li>
        <li>Slots 1 and 2 → formula, name, main bond type.</li>
        <li>Slot 3 → extra EN comparisons (Honors: triads).</li>
        <li>For covalent, adjust subscripts. Ionic subscripts are auto-balanced.</li>
      </ol>
    </div>
  </div>

  <div id="right">
    <div class="panel" id="builder">
      <h2>Element Slots (1 & 2 used for naming)</h2>
      <div class="slots-row">
        <div class="slot" id="slot1">
          <div class="slot-header">
            <span><input type="radio" name="activeSlot" value="1" checked /> Element 1</span>
            <button type="button" onclick="clearSlot(1)" style="font-size: 10px;">Clear</button>
          </div>
          <div class="slot-body">
            <div>
              <div class="slot-symbol" id="slot1-symbol">–</div>
              <div class="slot-meta" id="slot1-name">No element</div>
            </div>
            <div class="controls">
              <span>n₁:</span>
              <input type="number" id="slot1-count" min="1" max="10" value="1" onchange="updateAll()" />
            </div>
          </div>
        </div>
        <div class="slot" id="slot2">
          <div class="slot-header">
            <span><input type="radio" name="activeSlot" value="2" /> Element 2</span>
            <button type="button" onclick="clearSlot(2)" style="font-size: 10px;">Clear</button>
          </div>
          <div class="slot-body">
            <div>
              <div class="slot-symbol" id="slot2-symbol">–</div>
              <div class="slot-meta" id="slot2-name">No element</div>
            </div>
            <div class="controls">
              <span>n₂:</span>
              <input type="number" id="slot2-count" min="1" max="10" value="1" onchange="updateAll()" />
            </div>
          </div>
        </div>
        <div class="slot" id="slot3">
          <div class="slot-header">
            <span><input type="radio" name="activeSlot" value="3" /> Element 3 (EN only)</span>
            <button type="button" onclick="clearSlot(3)" style="font-size: 10px;">Clear</button>
          </div>
          <div class="slot-body">
            <div>
              <div class="slot-symbol" id="slot3-symbol">–</div>
              <div class="slot-meta" id="slot3-name">No element</div>
            </div>
            <div class="controls">
              <span>n₃:</span>
              <input type="number" id="slot3-count" min="1" max="10" value="1" onchange="updateAll()" />
            </div>
          </div>
        </div>
      </div>
      <button type="button" onclick="swapSlots12()" style="margin-top: 4px; font-size: 10px;">Swap 1 ↔ 2</button>
    </div>

    <div class="panel">
      <h2>Results (Slots 1 & 2)</h2>
      <table id="results-table">
        <tr>
          <td style="width: 32%;">Formula (1 & 2)</td>
          <td><span id="formula-display">–</span></td>
        </tr>
        <tr>
          <td>Name</td>
          <td><span id="name-display">–</span></td>
        </tr>
        <tr>
          <td>Bond & EN</td>
          <td>
            <div id="bond-summary"></div>
            <table id="pair-table">
              <thead>
                <tr>
                  <th>Pair</th>
                  <th>ΔEN</th>
                  <th>Type</th>
                </tr>
              </thead>
              <tbody id="pair-body"></tbody>
            </table>
          </td>
        </tr>
        <tr>
          <td>Why this name?</td>
          <td><div id="explanation"></div></td>
        </tr>
      </table>
    </div>
  </div>

  <script>
    // ======== ELEMENT DATA (first 20, enough for core HS naming) ========
    const elements = [
      {Z:1,  row:1, col:1,  symbol:"H",  name:"Hydrogen",  EN:2.20, category:"nonmetal",  isMetal:false, commonIonCharge:1},
      {Z:2,  row:1, col:18, symbol:"He", name:"Helium",    EN:null, category:"nonmetal",  isMetal:false},
      {Z:3,  row:2, col:1,  symbol:"Li", name:"Lithium",   EN:0.98, category:"metal",     isMetal:true,  commonIonCharge:1},
      {Z:4,  row:2, col:2,  symbol:"Be", name:"Beryllium", EN:1.57, category:"metal",     isMetal:true,  commonIonCharge:2},
      {Z:5,  row:2, col:13, symbol:"B",  name:"Boron",     EN:2.04, category:"metalloid", isMetal:false},
      {Z:6,  row:2, col:14, symbol:"C",  name:"Carbon",    EN:2.55, category:"nonmetal",  isMetal:false},
      {Z:7,  row:2, col:15, symbol:"N",  name:"Nitrogen",  EN:3.04, category:"nonmetal",  isMetal:false, commonIonCharge:-3},
      {Z:8,  row:2, col:16, symbol:"O",  name:"Oxygen",    EN:3.44, category:"nonmetal",  isMetal:false, commonIonCharge:-2},
      {Z:9,  row:2, col:17, symbol:"F",  name:"Fluorine",  EN:3.98, category:"nonmetal",  isMetal:false, commonIonCharge:-1},
      {Z:10, row:2, col:18, symbol:"Ne", name:"Neon",      EN:null, category:"nonmetal",  isMetal:false},
      {Z:11, row:3, col:1,  symbol:"Na", name:"Sodium",    EN:0.93, category:"metal",     isMetal:true,  commonIonCharge:1},
      {Z:12, row:3, col:2,  symbol:"Mg", name:"Magnesium", EN:1.31, category:"metal",     isMetal:true,  commonIonCharge:2},
      {Z:13, row:3, col:13, symbol:"Al", name:"Aluminum",  EN:1.61, category:"metal",     isMetal:true,  commonIonCharge:3},
      {Z:14, row:3, col:14, symbol:"Si", name:"Silicon",   EN:1.90, category:"metalloid", isMetal:false},
      {Z:15, row:3, col:15, symbol:"P",  name:"Phosphorus",EN:2.19, category:"nonmetal",  isMetal:false, commonIonCharge:-3},
      {Z:16, row:3, col:16, symbol:"S",  name:"Sulfur",    EN:2.58, category:"nonmetal",  isMetal:false, commonIonCharge:-2},
      {Z:17, row:3, col:17, symbol:"Cl", name:"Chlorine",  EN:3.16, category:"nonmetal",  isMetal:false, commonIonCharge:-1},
      {Z:18, row:3, col:18, symbol:"Ar", name:"Argon",     EN:null, category:"nonmetal",  isMetal:false},
      {Z:19, row:4, col:1,  symbol:"K",  name:"Potassium", EN:0.82, category:"metal",     isMetal:true,  commonIonCharge:1},
      {Z:20, row:4, col:2,  symbol:"Ca", name:"Calcium",   EN:1.00, category:"metal",     isMetal:true,  commonIonCharge:2}
    ];

    const tableContainer = document.getElementById("periodic-table");

    function buildPeriodicTable() {
      const maxRows = 7;
      const maxCols = 18;
      const map = {};
      elements.forEach(e => { map[`${e.row}-${e.col}`] = e; });

      for (let r = 1; r <= maxRows; r++) {
        for (let c = 1; c <= maxCols; c++) {
          const key = `${r}-${c}`;
          const cell = document.createElement("div");
          cell.style.gridRow = r;
          cell.style.gridColumn = c;
          if (map[key]) {
            const el = map[key];
            cell.classList.add("element");
            if (el.category === "metal") cell.classList.add("metal");
            else if (el.category === "nonmetal") cell.classList.add("nonmetal");
            else cell.classList.add("metalloid");
            cell.dataset.symbol = el.symbol;
            cell.title = `${el.name} (Z=${el.Z}) EN=${el.EN ?? "n/a"}`;
            cell.innerHTML = `<div>${el.symbol}</div><div style="font-size:9px;">${el.Z}</div>`;
            cell.onclick = () => handleElementClick(el.symbol);
          } else {
            cell.classList.add("element", "inactive");
            cell.innerHTML = "";
          }
          tableContainer.appendChild(cell);
        }
      }
    }

    // ======== STATE ========
    let slot1Element = null;
    let slot2Element = null;
    let slot3Element = null;

    function getActiveSlot() {
      const radios = document.getElementsByName("activeSlot");
      for (const r of radios) if (r.checked) return parseInt(r.value, 10);
      return 1;
    }

    function handleElementClick(symbol) {
      const el = elements.find(e => e.symbol === symbol);
      if (!el) return;
      const active = getActiveSlot();
      if (active === 1) {
        slot1Element = el;
        document.getElementById("slot1-symbol").textContent = el.symbol;
        document.getElementById("slot1-name").textContent = el.name;
      } else if (active === 2) {
        slot2Element = el;
        document.getElementById("slot2-symbol").textContent = el.symbol;
        document.getElementById("slot2-name").textContent = el.name;
      } else {
        slot3Element = el;
        document.getElementById("slot3-symbol").textContent = el.symbol;
        document.getElementById("slot3-name").textContent = el.name;
      }
      clearSelectionHighlight();
      highlightSelected();
      updateAll();
    }

    function clearSlot(i) {
      if (i === 1) {
        slot1Element = null;
        document.getElementById("slot1-symbol").textContent = "–";
        document.getElementById("slot1-name").textContent = "No element";
      } else if (i === 2) {
        slot2Element = null;
        document.getElementById("slot2-symbol").textContent = "–";
        document.getElementById("slot2-name").textContent = "No element";
      } else {
        slot3Element = null;
        document.getElementById("slot3-symbol").textContent = "–";
        document.getElementById("slot3-name").textContent = "No element";
      }
      clearSelectionHighlight();
      highlightSelected();
      updateAll();
    }

    function swapSlots12() {
      const tmpEl = slot1Element;
      slot1Element = slot2Element;
      slot2Element = tmpEl;

      const c1 = document.getElementById("slot1-count");
      const c2 = document.getElementById("slot2-count");
      const tmpCount = c1.value;
      c1.value = c2.value;
      c2.value = tmpCount;

      if (slot1Element) {
        document.getElementById("slot1-symbol").textContent = slot1Element.symbol;
        document.getElementById("slot1-name").textContent = slot1Element.name;
      } else {
        document.getElementById("slot1-symbol").textContent = "–";
        document.getElementById("slot1-name").textContent = "No element";
      }
      if (slot2Element) {
        document.getElementById("slot2-symbol").textContent = slot2Element.symbol;
        document.getElementById("slot2-name").textContent = slot2Element.name;
      } else {
        document.getElementById("slot2-symbol").textContent = "–";
        document.getElementById("slot2-name").textContent = "No element";
      }
      clearSelectionHighlight();
      highlightSelected();
      updateAll();
    }

    function clearSelectionHighlight() {
      document.querySelectorAll(".element").forEach(cell => cell.classList.remove("selected"));
    }

    function highlightSelected() {
      const syms = [];
      if (slot1Element) syms.push(slot1Element.symbol);
      if (slot2Element) syms.push(slot2Element.symbol);
      if (slot3Element) syms.push(slot3Element.symbol);
      document.querySelectorAll(".element").forEach(cell => {
        if (syms.includes(cell.dataset.symbol)) cell.classList.add("selected");
      });
    }

    // ======== HELPERS ========
    const prefixes = {
      1: "mono",
      2: "di",
      3: "tri",
      4: "tetra",
      5: "penta",
      6: "hexa",
      7: "hepta",
      8: "octa",
      9: "nona",
      10: "deca"
    };

    function anionStem(name) {
      name = name.toLowerCase();
      if (name.endsWith("ine")) return name.slice(0, -3) + "id";
      if (name.endsWith("gen")) return name.slice(0, -3) + "id";
      if (name.endsWith("ur")) return name + "id";
      if (name.endsWith("orus")) return name.slice(0, -4) + "phid";
      if (name.endsWith("on")) return name.slice(0, -2) + "id";
      return name + "id";
    }

    function cap(str) {
      if (!str) return str;
      return str.charAt(0).toUpperCase() + str.slice(1);
    }

    function gcd(a, b) {
      if (!b) return a;
      return gcd(b, a % b);
    }

    function subscript(n) {
      return n === 1 ? "" : n.toString();
    }

    function classifyBond(en1, en2) {
      if (en1 == null || en2 == null) return {delta: null, type: "EN missing"};
      const d = Math.abs(en1 - en2);
      let t;
      if (d > 1.7) t = "Ionic";
      else if (d >= 0.4) t = "Polar covalent";
      else t = "Non-polar covalent";
      return {delta: d, type: t};
    }

    // ======== MAIN UPDATE ========
    function updateAll() {
      const formulaDisplay = document.getElementById("formula-display");
      const nameDisplay = document.getElementById("name-display");
      const bondSummary = document.getElementById("bond-summary");
      const pairBody = document.getElementById("pair-body");
      const explanation = document.getElementById("explanation");

      const n1 = parseInt(document.getElementById("slot1-count").value, 10) || 1;
      const n2 = parseInt(document.getElementById("slot2-count").value, 10) || 1;
      const n3 = parseInt(document.getElementById("slot3-count").value, 10) || 1;

      pairBody.innerHTML = "";

      if (!slot1Element || !slot2Element) {
        formulaDisplay.textContent = "–";
        nameDisplay.textContent = "–";
        bondSummary.textContent = "Select at least elements in slots 1 and 2 to get a formula, name, and main bond type.";
        explanation.textContent = "";
        renderPairRow("1–2", slot1Element, slot2Element);
        renderPairRow("1–3", slot1Element, slot3Element);
        renderPairRow("2–3", slot2Element, slot3Element);
        return;
      }

      const e1 = slot1Element;
      const e2 = slot2Element;

      const isIonicByType =
        (e1.isMetal && !e2.isMetal) ||
        (e2.isMetal && !e1.isMetal);

      let formula = "";
      let compoundName = "";
      let explainText = "";
      let modeLabel = "";

      if (isIonicByType) {
        // Ionic: ignore user subscripts; use charges to balance.
        const cation = e1.isMetal ? e1 : e2;
        const anion = e1.isMetal ? e2 : e1;
        const cCharge = cation.commonIonCharge ?? 1;
        const aCharge = anion.commonIonCharge ?? -1;
        const a = Math.abs(cCharge);
        const b = Math.abs(aCharge);
        const g = gcd(a, b);
        const nCation = b / g;
        const nAnion = a / g;

        if (e1 === cation) {
          formula = `${cation.symbol}${subscript(nCation)}${anion.symbol}${subscript(nAnion)}`;
        } else {
          formula = `${anion.symbol}${subscript(nAnion)}${cation.symbol}${subscript(nCation)}`;
        }

        const cName = cap(cation.name.toLowerCase());
        const stem = anionStem(anion.name);
        const anionName = stem + "e"; // oxide, sulfide, etc.
        compoundName = `${cName} ${anionName}`;

        modeLabel = "[Ionic: metal + nonmetal]";
        explainText =
          "Metal + nonmetal → ionic naming.\n" +
          `${cation.name} is treated as a cation (positive ion).\n` +
          `${anion.name} is treated as an anion; its name ends in “-ide”.\n` +
          "Subscripts are chosen to balance total positive and negative charge.";
      } else {
        // Covalent: use user subscripts for 1 & 2
        formula = `${e1.symbol}${subscript(n1)}${e2.symbol}${subscript(n2)}`;

        let firstName = e1.name.toLowerCase();
        if (n1 > 1 && prefixes[n1]) {
          firstName = prefixes[n1] + " " + firstName;
        }

        const stem = anionStem(e2.name);
        let secondName = stem + "e";
        if (prefixes[n2]) {
          secondName = prefixes[n2] + " " + secondName;
        }

        compoundName = `${cap(firstName)} ${secondName}`;
        modeLabel = "[Covalent: nonmetal + nonmetal / metalloid]";

        explainText =
          "Nonmetal + nonmetal / metalloid → covalent naming.\n" +
          `Subscripts (n₁, n₂) come from how many atoms you choose.\n` +
          "Prefixes (di-, tri-, tetra-, etc.) show the number of atoms.\n" +
          "The first element omits “mono-” when there is only one atom.";
      }

      // Bond classification for pair 1–2
      const mainBond = classifyBond(e1.EN, e2.EN);
      let mainSummary = "";
      if (mainBond.delta == null) {
        mainSummary = `${modeLabel} EN data incomplete for 1–2.`;
      } else {
        mainSummary =
          `${modeLabel} ΔEN(1–2) = |EN(${e1.symbol}) − EN(${e2.symbol})| = ` +
          `|${e1.EN.toFixed(2)} − ${e2.EN.toFixed(2)}| = ${mainBond.delta.toFixed(2)} → ${mainBond.type}.`;
      }

      // Fill main outputs
      formulaDisplay.textContent = formula;
      nameDisplay.textContent = compoundName;
      bondSummary.textContent = mainSummary;
      explanation.textContent = explainText;

      // Pair table for Honors EN exploration
      renderPairRow("1–2", slot1Element, slot2Element);
      renderPairRow("1–3", slot1Element, slot3Element);
      renderPairRow("2–3", slot2Element, slot3Element);
    }

    function renderPairRow(label, eA, eB) {
      const body = document.getElementById("pair-body");
      const tr = document.createElement("tr");
      const tdPair = document.createElement("td");
      const tdDelta = document.createElement("td");
      const tdType = document.createElement("td");

      if (!eA || !eB) {
        tdPair.textContent = label;
        tdDelta.textContent = "–";
        tdType.textContent = "—";
      } else {
        const info = classifyBond(eA.EN, eB.EN);
        tdPair.textContent = `${label}: ${eA.symbol}-${eB.symbol}`;
        if (info.delta == null) {
          tdDelta.textContent = "n/a";
          tdType.textContent = "EN missing";
        } else {
          tdDelta.textContent = info.delta.toFixed(2);
          tdType.textContent = info.type;
        }
      }

      tr.appendChild(tdPair);
      tr.appendChild(tdDelta);
      tr.appendChild(tdType);
      body.appendChild(tr);
    }

    // ======== INIT ========
    buildPeriodicTable();
    updateAll();
  </script>
</body>
</html>
